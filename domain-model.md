# Модель доменной области

Изначально **предметно-ориентированное проектирование (DDD)** было определено как подход к разработке программного обеспечения, который начинается с единого языка, проходит через карту ограниченных контекстов и заканчивается рекомендуемой многоуровневой архитектурой, ориентированной на объектно-ориентированную модель предметной области.

Тут мы разберём **принципы DDD** с акцентом на абстрактную предметную область.

## Модель предметной области

- Модель предметной области предназначена для того, чтобы максимально точно выразить понятия основного бизнеса, для которого предназначено приложение.
- Модель предметной области - это интерфейс прикладного программирования основного бизнеса, и необходимо, чтобы классы модели предметной области были всегда согласованы с бизнес-концепцией, которую они представляют.
- Модель предметной области - это коллекция классов со свойствами и методами.
- Для обеспечения постоянной непротиворечивости с бизнесом необходимо сфокусировать свой проект в _большей_ степени на **поведении**, а не на данных.

> Суть `DDD` заключается в том, что моделирование предметной бласти выполняется первым, а всё остальное уже является средствами работы с/над нашей моделью предметной области.

### Принципы модели предметной области

- в классы модели предметной области нельзя включать методы для сохранения экземпляров на диске и считывания их оттуда;
- классы моделей предметной области не должны открывать методы, которые требуют доступа к уровню постоянного хранения;
- модель предметной области должна иметь минимальный набр зависимостей от инфраструктуры, обеспечивающих её работоспособность, - а лучше, если этих зависимостей совсем нет.

### Формальное определение модели предметной области

> #### Модель предметной области обеспечивает концептуальное представление бизнес-логики. Эта модель состоит из сущностей и объектов-значений и моделирует реальные понятия для того, чтобы превратить их в компоненты ПО

## События предметной области

**Событие предметной области** - это обычный класс, который описывает важное явление в предметной области _(например, когда кто-то создаёт заказ или достигает золотого статуса)_.

```csharp
public interface IDomainEvent { }

public class CustomerReachedGoldMemberStatus : IDomainEvent
{
    public Customer Customer { get; set; }
}
```

### Генерация и обработка событий предметной области

#### Генератор событий

```csharp
public class Bus
{
    private static IList<IHandler<IDomainEvent>> Handlers = new ();

    public static coid Register(IHandler<DomainEvent> handler)
    {
        Handlers.Add(handler);
    }

    public static Raise<T>(T eventData) 
        where T : IDomainEvent
    {
        foreach(var handler in Handlers)
        {
            if (!handler.CanHandle(eventData))
                continue;

            handler.Handle(eventData);
        }

    }
}
```

#### Обработчик событий

**Обработчик событий предметной области** - это обычный класс, который содержит логику для обработки реакции на события (например, прохождение по списку всех подписчиков и их оповещение о событии).

```csharp
public class GoldStatusHandler : IHandler<IDomainEvent>
{
    public void Handle(IDomainEvent eventData)
    {
        // обработка события
    }

    public bool CanHandle(IDomainEvent eventType)
    {
        return eventType is CustomerReachedGoldMemberStatus;
    }
}
```

### Резюме

Модель предметной области пытается моделировать предметную область с точки зрения сущностей и объектов значений, а также отношений между ними, состояния и поведения.

**Сущность** - это релевантный объект в бизнес-пространстве; у него есть идентификационные данные и срок действия.

**Объект-значение** - это "неодушевлённая" вещь в бизнес-пространстве.

## Сущность DDD

Сущность DDD - это класс, **который** должен содержать _данные (свойства)_ и _поведение (методы)_. Он не должен быть простым контейнером данных.

### Признаки сущностей DDD

- Точно определённая идентичность
- Поведение, выраженное с помощью методов _(открытых или закрытых)_
- Состояние, выраженное с помощью свойств, предназначенных только для чтения
- Очень ограниченное использование элементарных типов, которые заменяются объектами-значениями
- Предпочтение фабичных методов многочисленным конструкторам